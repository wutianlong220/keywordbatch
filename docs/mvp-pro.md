# MVP 产品需求文档：批量 XLSX 关键词处理工具（本地浏览器界面）

## 1. 产品概述

该工具基于现有单文件处理插件改造而来，核心目标是：

* 批量处理指定文件夹下的所有 XLSX 文件；
* 支持大文件分批处理；
* 支持文件级断点续传；
* 保留实时日志和进度显示；
* 输出文件带后缀；
* 所有 API Key 和模型地址仅存于本地 `.env` 文件，无需界面输入。另外生成配套的`.gitignore`文件，不让`.env`上传到git仓库

产品完全本地运行，通过浏览器打开本地页面操作，无需服务器部署。

---

## 2. 用户使用场景

### 场景 1：处理大量 XLSX 文件

用户手上有一个文件夹，里面有几十个 XLSX 文件，每个文件包含若干关键词，需要调用大模型翻译和处理。原来单文件处理效率低，希望一次性批量处理。

### 场景 2：处理大文件

单个 XLSX 文件可能很大，需分批处理（原插件已支持），用户希望界面显示当前文件的批次进度。

### 场景 3：处理中断与错误处理

* 如果程序意外中断，下次重新运行时能从未完成的文件开始处理；
* 如果某个文件本身有问题无法处理，工具会自动移动到 `处理失败` 文件夹，并在日志中标记。

---

## 3. 用户使用流程

1. **启动工具**

   * 用户打开本地浏览器访问本地网页（如 `http://localhost:5050`），如果已经打开过一个，则关闭之前那个，重新打开一个，防止端口冲突。
   * 界面显示输入文件夹、输出文件夹选择按钮、开始处理按钮、日志区域、总结板块。

2. **选择文件夹**

   * 输入文件夹：存放需要处理的 XLSX 文件（只遍历当前文件夹，不遍历子文件夹）。
   * 输出文件夹：存放处理完成的文件。

3. **开始处理**

   * 用户点击「开始处理」。
   * 系统依次读取输入文件夹下的每个 XLSX 文件。

4. **批处理逻辑**

   * 对每个文件，调用原插件的单文件处理逻辑，按批次处理大文件。
   * **日志输出**显示：

     * 当前文件编号 / 总文件数
     * 当前文件批次编号 / 总批次数
     * 每个批次的处理结果（成功或失败）

5. **文件处理完成与进度记录**

   * **文件级断点**：只有当整个文件的所有批次都成功完成后，才写入 `progress.json` 记录已完成文件。
   * 如果程序中途崩溃，未完成的文件不会被记录，下次重新处理整个文件。

6. **错误处理**

   * 如果文件本身无法处理（例如文件损坏），直接移动到输入文件夹下的 `处理失败` 文件夹。
   * 界面日志中标记失败，最终总结板块汇总失败文件列表。
   * `处理失败` 文件夹重复运行时会复用，不重复创建。

7. **输出文件命名规则**

   * 输出文件与原文件同名，但加后缀（例如 `_processed.xlsx`）。
   * 可选：后续版本可加时间戳或自定义后缀。

8. **总结板块**

   * 显示总文件数、成功处理数、失败文件数及失败文件名列表。
   * 方便用户快速确认处理结果。

---

## 4. 功能清单

| 功能模块    | 描述                           | 注意事项                    |
| ------- | ---------------------------- | ----------------------- |
| 输入文件夹选择 | 选择要处理的 XLSX 文件夹              | 只处理当前目录，不遍历子文件夹         |
| 输出文件夹选择 | 指定处理完成文件存放位置                 | 文件加后缀 `_processed.xlsx` |
| 批处理逻辑   | 循环遍历每个文件，调用原单文件处理函数          | 保留原有分批处理逻辑              |
| 文件级进度记录 | 成功处理完成的文件写入 `progress.json`  | 保证断点续传，未完成文件不写          |
| 日志输出    | 实时显示处理日志，包括文件编号、批次编号、成功/失败状态 | 逐条输出，便于观察进度             |
| 错误处理    | 文件本身无法处理 → 移动到 `处理失败` 文件夹    | 日志标记失败，最终总结汇总           |
| 总结板块    | 显示总文件数、已完成数、失败文件数和列表         | 最终确认批处理情况               |
| API 配置  | 仅读取 `.env` 本地文件，不在界面显示       | 简化界面，无服务器风险             |

---

## 5. 技术与实现注意事项

* 保留原插件的批次处理逻辑，不改核心功能；
* 界面保留原网页样式，但去掉 API 配置部分；
* 日志输出和总结板块实时更新，保证用户可追踪；
* 失败文件移动与进度记录严格区分，确保程序崩溃时不会误标完成。

## 6. 参考源代码

* 原来的插件的代码在文件夹keywords_tools里面，可供参考