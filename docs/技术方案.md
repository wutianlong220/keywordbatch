# 关键词批量处理工具 - 技术方案文档

## 📋 项目概述

### 项目背景
本项目基于现有的Chrome扩展关键词处理工具，旨在提供一个更强大的本地化关键词批量处理解决方案。现有的Chrome扩展已经实现了核心功能，包括XLSX文件处理、DeepSeek API翻译、Kdroi计算和多平台链接生成。

### 项目目标
- **本地化处理**：完全在本地运行，无需依赖浏览器扩展
- **批量处理**：支持指定文件夹批量处理多个XLSX文件
- **友好界面**：提供Web界面进行操作和进度监控
- **实时反馈**：显示处理进度和结果状态

## 🏗️ 架构设计

### 整体架构
采用**前后端分离**的本地Web应用架构：

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端界面      │    │   后端服务      │    │   文件系统      │
│  (浏览器)       │◄──►│  (Python Flask) │◄──►│  (本地文件夹)   │
│                 │    │                 │    │                 │
│ • 文件选择      │    │ • 文件处理      │    │ • 输入文件夹    │
│ • 进度显示      │    │ • API调用       │    │ • 输出文件夹    │
│ • 配置管理      │    │ • 任务管理      │    │                 │
│ • 结果展示      │    │                 │    │                 │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                │
                                ▼
                       ┌─────────────────┐
                       │   外部API       │
                       │  (DeepSeek)     │
                       │                 │
                       │ • 翻译服务      │
                       │ • AI处理        │
                       └─────────────────┘
```

### 核心组件

#### 1. 前端界面 (HTML/CSS/JavaScript)
- **文件选择器**：选择要处理的文件夹
- **进度条**：实时显示处理进度
- **配置面板**：API配置和处理选项
- **日志区域**：显示处理日志和错误信息
- **结果展示**：处理完成后的结果统计

#### 2. 后端服务 (Python Flask)
- **Web服务器**：提供前端界面和API接口
- **文件处理器**：读取和处理XLSX文件
- **API客户端**：调用DeepSeek API
- **任务管理器**：管理处理任务和队列
- **结果生成器**：生成处理后的文件

#### 3. 文件系统集成
- **文件夹监控**：监控指定文件夹的文件变化
- **批量处理**：批量处理多个XLSX文件
- **文件管理**：输入输出文件管理

## 🛠️ 技术栈选择

### 后端技术栈
- **Python 3.8+**：主要开发语言
- **Flask**：轻量级Web框架
- **Flask-CORS**：处理跨域请求
- **pandas**：数据处理和分析
- **openpyxl**：XLSX文件处理
- **requests**：HTTP请求库
- **watchdog**：文件夹监控（可选）
- **pathlib**：文件路径操作

### 前端技术栈
- **HTML5**：页面结构
- **CSS3**：样式设计
- **Vanilla JavaScript**：交互逻辑
- **Bootstrap 5**：UI组件库（可选）
- **Chart.js**：进度图表（可选）

### 选择理由
1. **Python**：强大的文件处理能力，丰富的库支持
2. **Flask**：轻量级，易于部署，适合本地应用
3. **pandas**：高效的数据处理，特别适合表格数据
4. **原生JavaScript**：无依赖，轻量级，易于维护

## 🔧 功能模块设计

### 1. 文件处理模块
```python
class FileProcessor:
    """文件处理核心类"""
    
    def __init__(self, input_folder, output_folder):
        self.input_folder = input_folder
        self.output_folder = output_folder
        
    def scan_files(self):
        """扫描文件夹中的XLSX文件"""
        pass
        
    def process_file(self, file_path):
        """处理单个XLSX文件"""
        pass
        
    def batch_process(self):
        """批量处理所有文件"""
        pass
```

### 2. API集成模块
```python
class DeepSeekAPI:
    """DeepSeek API集成类"""
    
    def __init__(self, api_key, api_endpoint):
        self.api_key = api_key
        self.api_endpoint = api_endpoint
        
    async def translate_keywords(self, keywords):
        """批量翻译关键词"""
        pass
```

### 3. 任务管理模块
```python
class TaskManager:
    """任务管理类"""
    
    def __init__(self):
        self.tasks = {}
        self.current_task = None
        
    def create_task(self, task_data):
        """创建新任务"""
        pass
        
    def update_progress(self, task_id, progress):
        """更新任务进度"""
        pass
        
    def get_task_status(self, task_id):
        """获取任务状态"""
        pass
```

### 4. Web界面模块
```python
@app.route('/')
def index():
    """主页"""
    return render_template('index.html')

@app.route('/api/process', methods=['POST'])
def process_files():
    """处理文件API"""
    pass

@app.route('/api/progress/<task_id>')
def get_progress(task_id):
    """获取进度API"""
    pass
```

## 📁 项目结构

```
keywordbatch/
├── app.py                 # Flask应用主文件
├── config.py              # 配置文件
├── requirements.txt       # Python依赖
├── templates/
│   ├── index.html        # 主页模板
│   └── progress.html     # 进度页面模板
├── static/
│   ├── css/
│   │   └── style.css      # 样式文件
│   └── js/
│       └── script.js      # 前端脚本
├── services/
│   ├── file_processor.py  # 文件处理服务
│   ├── api_client.py      # API客户端
│   └── task_manager.py   # 任务管理器
├── utils/
│   ├── excel_utils.py    # Excel工具函数
│   └── validation.py     # 数据验证
├── tests/
│   ├── test_file_processor.py
│   └── test_api_client.py
├── docs/
│   └── 技术方案.md        # 本文档
└── keywords_tools/        # 参考的Chrome扩展代码
```

## 🚀 部署方案

### 本地部署
1. **环境准备**：
   ```bash
   python -m venv venv
   source venv/bin/activate  # Windows: venv\Scripts\activate
   pip install -r requirements.txt
   ```

2. **启动服务**：
   ```bash
   python app.py
   ```

3. **访问应用**：
   - 打开浏览器访问 `http://localhost:5000`
   - 或 `http://127.0.0.1:5000`

### 配置文件
```python
# config.py
class Config:
    # API配置
    DEEPSEEK_API_KEY = "your_api_key_here"
    DEEPSEEK_API_ENDPOINT = "https://api.deepseek.com/v1/chat/completions"
    
    # 文件夹配置
    DEFAULT_INPUT_FOLDER = "./input"
    DEFAULT_OUTPUT_FOLDER = "./output"
    
    # 应用配置
    DEBUG = True
    HOST = "127.0.0.1"
    PORT = 5000
```

## 📋 开发计划

### 第一阶段：基础框架搭建（1-2天）
1. **项目初始化**
   - 创建项目结构
   - 安装依赖包
   - 配置Flask应用

2. **基础界面**
   - 创建主页模板
   - 实现文件选择功能
   - 基础样式设计

### 第二阶段：核心功能实现（3-4天）
1. **文件处理模块**
   - 实现XLSX文件读取
   - 数据处理逻辑
   - 结果文件生成

2. **API集成**
   - DeepSeek API集成
   - 批量翻译功能
   - 错误处理机制

### 第三阶段：界面完善（2-3天）
1. **进度显示**
   - 实时进度更新
   - 处理状态显示
   - 日志展示

2. **用户体验**
   - 响应式设计
   - 错误提示
   - 配置保存

### 第四阶段：测试优化（1-2天）
1. **功能测试**
   - 单元测试
   - 集成测试
   - 用户测试

2. **性能优化**
   - 大文件处理优化
   - 并发处理
   - 内存管理

## 🔒 安全考虑

### API安全
- API密钥加密存储
- 请求频率限制
- 错误信息保护

### 文件安全
- 文件类型验证
- 文件大小限制
- 路径遍历防护

### 数据安全
- 本地处理，无数据上传
- 处理完成后清理临时文件
- 用户隐私保护

## 📊 预期效果

### 功能指标
- ✅ 支持批量处理多个XLSX文件
- ✅ 实时显示处理进度
- ✅ 支持暂停/继续处理
- ✅ 配置自动保存
- ✅ 错误处理和恢复

### 性能指标
- 处理速度：1000条关键词/分钟
- 内存占用：<100MB
- 支持文件大小：最大50MB
- 并发处理：支持多任务队列

## 🎯 总结

本技术方案基于现有的Chrome扩展功能，提供了一个完整的本地化Web应用解决方案。通过Python Flask后端和现代Web前端的结合，实现了：

1. **更好的用户体验**：友好的Web界面，实时进度反馈
2. **更强的处理能力**：批量处理，多文件支持
3. **更高的安全性**：完全本地处理，数据不外泄
4. **更好的维护性**：模块化设计，易于扩展

该方案既保留了原有Chrome扩展的核心功能，又提供了更好的用户体验和更强的处理能力，是一个理想的升级方案。